{{- if .Values.externalSecret }}
{{- range $key, $val := .Values.externalSecret }}
apiVersion: 'kubernetes-client.io/v1'
kind: ExternalSecret
metadata:
  name: {{ $key }}
  {{- if $.Values.external_secrets.annotations }}
  annotations:
{{ toYaml $.Values.external_secrets.annotations | indent 4 }}
  {{- end }}
spec:
  backendType: secretsManager
  data:
    {{- range $env, $value := $val }}
    - key: {{ $key }}
      name: {{ $value }}
      property: {{ $value }}
      {{- if regexMatch "^NONBINARY_" $value }}
      isBinary: false
      {{ else if regexMatch "^BINARY_" $value }}
      isBinary: true
      {{ end }}
    {{- end }}
---
{{- end }}
{{- end }}
